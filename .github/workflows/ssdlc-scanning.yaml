name: SSDLC scanning

on:
    workflow_dispatch:
    pull_request:  # fixme: do not merge this, for testing only
    schedule:
      - cron: "0 1 * * 1"  # Runs at 1am UTC every Monday

jobs:
    scan:
        runs-on: [self-hosted]
        strategy:
          fail-fast: false
          matrix:
            type: [sbom, secscan]
            artifact: [rock, charm]
        name: SSDLC scanning - ${{ matrix.type }} - ${{ matrix.artifact }} artifacts
        steps:
          - name: Run sbomber action
            uses: canonical/sbomber/.github/actions/run@feat/reusable-workflow
            with:
              manifest: "${{ github.workspace }}/ssdlc-manifests/${{ matrix.artifact }}-${{ matrix.type }}-manifest.yaml"
