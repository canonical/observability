name: Pull Request
# quality checks to make sure the change won't break things

on:
  workflow_call:


jobs:
  test:
    name: Test the rock
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Setup requirements
        run: |
          snap install concierge --classic
          concierge prepare -p microk8s
          pip install git+https://github.com/lucabello/noctua
      - name: Pack the rock
        run: |
          cd ${{ inputs.rock-path }} && rockcraft pack --output test.rock
      - name: Test the rock
        run: |
          noctua rock test ${{ inputs.rock-path }}/test.rock --goss-file=goss.yaml --one-shot
